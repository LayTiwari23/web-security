{% extends "base.html" %}

{% block title %}Dashboard - Web Security Compliance Checker{% endblock %}

{% block content %}
<div class="dashboard-container">
    <h1>Dashboard</h1>

    <section class="dashboard-intro">
        <p>
            Welcome to the Web Security Compliance Checker.
            Use this dashboard to manage your targets, run scans, and download PDF reports.
        </p>
    </section>

    <section class="dashboard-actions">
        <div class="card">
            <h2>Targets</h2>
            <p>Manage the websites and applications you want to scan.</p>
            <a class="btn" href="/api/v1/targets/html">View Targets</a>
        </div>

        <div class="card">
            <h2>Scans</h2>
            <p>Review past scans and start new ones for your targets.</p>
            <a class="btn" href="/api/v1/scans/html">View Scans</a>
        </div>

        <div class="card">
            <h2>Reports</h2>
            <p>Download or delete generated PDF reports.</p>
            <a class="btn" href="/api/v1/reports/html">View Reports</a>
        </div>

        <div class="card danger-card">
            <h2>System Cleanup</h2>
            <p>Permanently remove all targets, scan history, and generated reports.</p>
            <button class="btn btn-danger" onclick="confirmDeleteAll()">Delete All Data</button>
        </div>
    </section>
</div>

<script>
async function confirmDeleteAll() {
    // Two-step verification for safety
    const firstCheck = confirm("Are you sure you want to delete ALL data? This includes targets, scans, and PDF reports.");
    if (!firstCheck) return;

    const secondCheck = confirm("FINAL WARNING: This action cannot be undone. Do you really want to proceed?");
    if (secondCheck) {
        try {
            const response = await fetch('/api/v1/reports/delete-all', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                alert("Database cleared successfully.");
                window.location.reload();
            } else {
                const error = await response.json();
                alert("Error: " + (error.detail || "Unauthorized or Session Expired."));
            }
        } catch (err) {
            console.error("Cleanup failed:", err);
            alert("A network error occurred. Please try again.");
        }
    }
}
</script>
{% endblock %}